{% extends "base.html" %}

{% block title %}Interview Calendar - Web-Inter-Prep{% endblock %}

{% block extra_css %}
<style>
    .calendar-container {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .calendar-header {
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        color: white;
        padding: 1.5rem;
        text-align: center;
    }
    
    .calendar-nav {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        background: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
    
    .calendar-grid {
        display: grid;
        grid-template-columns: repeat(7, 1fr);
        gap: 1px;
        background: #dee2e6;
    }
    
    .calendar-day {
        background: white;
        min-height: 120px;
        padding: 0.5rem;
        position: relative;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .calendar-day:hover {
        background: #f8f9fa;
    }
    
    .calendar-day.other-month {
        background: #f8f9fa;
        color: #6c757d;
    }
    
    .calendar-day.today {
        background: #e3f2fd;
        border: 2px solid #2196f3;
    }
    
    .calendar-day.has-interview {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
    }
    
    .calendar-day.has-interview:hover {
        background: #ffeaa7;
    }
    
    .day-number {
        font-weight: 600;
        margin-bottom: 0.25rem;
    }
    
    .interview-event {
        background: #007bff;
        color: white;
        padding: 0.125rem 0.25rem;
        border-radius: 3px;
        font-size: 0.75rem;
        margin-bottom: 0.125rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .interview-event.mock {
        background: #28a745;
    }
    
    .interview-event.ai {
        background: #6f42c1;
    }
    
    .interview-event.practice {
        background: #fd7e14;
    }
    
    .weekday-header {
        background: #495057;
        color: white;
        padding: 0.75rem;
        text-align: center;
        font-weight: 600;
        font-size: 0.875rem;
    }
    
    .add-interview-btn {
        position: fixed;
        bottom: 2rem;
        right: 2rem;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: #007bff;
        color: white;
        border: none;
        box-shadow: 0 4px 12px rgba(0, 123, 255, 0.3);
        font-size: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        z-index: 1000;
    }
    
    .add-interview-btn:hover {
        background: #0056b3;
        transform: scale(1.1);
    }
    
    .stats-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .stats-number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }
    
    .legend {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1rem;
    }
    
    .legend-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
    }
    
    .legend-color {
        width: 16px;
        height: 16px;
        border-radius: 3px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-1">
                        <i class="fas fa-calendar-alt me-2 text-primary"></i>Interview Calendar
                    </h1>
                    <p class="text-muted mb-0">Track your interview preparation schedule</p>
                </div>
                <div class="d-flex gap-2">
                    <button class="btn btn-outline-primary" onclick="exportCalendar()">
                        <i class="fas fa-download me-2"></i>Export
                    </button>
                    <button class="btn btn-primary" onclick="showAddInterviewModal()">
                        <i class="fas fa-plus me-2"></i>Add Interview
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stats-card text-center">
                <div class="stats-number" id="total-interviews">0</div>
                <div>Total Interviews</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card text-center">
                <div class="stats-number" id="this-month">0</div>
                <div>This Month</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card text-center">
                <div class="stats-number" id="completed">0</div>
                <div>Completed</div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stats-card text-center">
                <div class="stats-number" id="upcoming">0</div>
                <div>Upcoming</div>
            </div>
        </div>
    </div>

    <!-- Calendar -->
    <div class="row">
        <div class="col-12">
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 id="current-month-year">January 2024</h3>
                </div>
                
                <div class="calendar-nav">
                    <button class="btn btn-outline-secondary" onclick="previousMonth()">
                        <i class="fas fa-chevron-left me-2"></i>Previous
                    </button>
                    <button class="btn btn-outline-primary" onclick="goToToday()">
                        <i class="fas fa-home me-2"></i>Today
                    </button>
                    <button class="btn btn-outline-secondary" onclick="nextMonth()">
                        Next<i class="fas fa-chevron-right ms-2"></i>
                    </button>
                </div>
                
                <div class="calendar-grid">
                    <!-- Weekday headers -->
                    <div class="weekday-header">Sun</div>
                    <div class="weekday-header">Mon</div>
                    <div class="weekday-header">Tue</div>
                    <div class="weekday-header">Wed</div>
                    <div class="weekday-header">Thu</div>
                    <div class="weekday-header">Fri</div>
                    <div class="weekday-header">Sat</div>
                    
                    <!-- Calendar days will be populated by JavaScript -->
                    <div id="calendar-days"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h6 class="card-title">Legend</h6>
                    <div class="legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #28a745;"></div>
                            <span>Mock Interview</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #6f42c1;"></div>
                            <span>AI Interview</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #fd7e14;"></div>
                            <span>Practice Session</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #007bff;"></div>
                            <span>Other Interview</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Interview Modal -->
<div class="modal fade" id="addInterviewModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Interview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addInterviewForm">
                    <div class="mb-3">
                        <label for="interviewTitle" class="form-label">Title</label>
                        <input type="text" class="form-control" id="interviewTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="interviewType" class="form-label">Type</label>
                        <select class="form-select" id="interviewType" required>
                            <option value="mock">Mock Interview</option>
                            <option value="ai">AI Interview</option>
                            <option value="practice">Practice Session</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="interviewDate" class="form-label">Date</label>
                        <input type="date" class="form-control" id="interviewDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="interviewTime" class="form-label">Time</label>
                        <input type="time" class="form-control" id="interviewTime" required>
                    </div>
                    <div class="mb-3">
                        <label for="interviewDuration" class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-control" id="interviewDuration" value="30" min="15" max="180">
                    </div>
                    <div class="mb-3">
                        <label for="interviewNotes" class="form-label">Notes (optional)</label>
                        <textarea class="form-control" id="interviewNotes" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveInterview()">Save Interview</button>
            </div>
        </div>
    </div>
</div>

<!-- Floating Add Button -->
<button class="add-interview-btn" onclick="showAddInterviewModal()" title="Add Interview">
    <i class="fas fa-plus"></i>
</button>
{% endblock %}

{% block extra_js %}
<script>
let currentDate = new Date();
let interviews = [];

// Initialize calendar
document.addEventListener('DOMContentLoaded', function() {
    loadInterviews();
    renderCalendar();
    updateStats();
});

function loadInterviews() {
    // Load interviews from localStorage (in a real app, this would be from the server)
    const saved = localStorage.getItem('interviewCalendar');
    if (saved) {
        interviews = JSON.parse(saved);
    } else {
        // Sample data for demonstration
        interviews = [
            {
                id: 1,
                title: "Mock Interview - Technical",
                type: "mock",
                date: "2024-01-15",
                time: "14:00",
                duration: 30,
                notes: "Focus on algorithms and data structures"
            },
            {
                id: 2,
                title: "AI Interview - System Design",
                type: "ai",
                date: "2024-01-18",
                time: "10:00",
                duration: 45,
                notes: "Practice system design questions"
            },
            {
                id: 3,
                title: "Practice Session - JavaScript",
                type: "practice",
                date: "2024-01-20",
                time: "16:00",
                duration: 60,
                notes: "Review JavaScript fundamentals"
            }
        ];
        saveInterviews();
    }
}

function saveInterviews() {
    localStorage.setItem('interviewCalendar', JSON.stringify(interviews));
}

function renderCalendar() {
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    
    // Update header
    const monthNames = ["January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"];
    document.getElementById('current-month-year').textContent = 
        `${monthNames[month]} ${year}`;
    
    // Get first day of month and number of days
    const firstDay = new Date(year, month, 1);
    const lastDay = new Date(year, month + 1, 0);
    const daysInMonth = lastDay.getDate();
    const startingDayOfWeek = firstDay.getDay();
    
    // Clear calendar
    const calendarDays = document.getElementById('calendar-days');
    calendarDays.innerHTML = '';
    
    // Add empty cells for days before the first day of the month
    for (let i = 0; i < startingDayOfWeek; i++) {
        const dayElement = createDayElement(0, true);
        calendarDays.appendChild(dayElement);
    }
    
    // Add days of the month
    for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = createDayElement(day, false);
        calendarDays.appendChild(dayElement);
    }
    
    // Fill remaining cells to complete the grid
    const totalCells = calendarDays.children.length;
    const remainingCells = 42 - totalCells; // 6 rows × 7 days
    for (let i = 0; i < remainingCells; i++) {
        const dayElement = createDayElement(0, true);
        calendarDays.appendChild(dayElement);
    }
}

function createDayElement(day, isOtherMonth) {
    const dayElement = document.createElement('div');
    dayElement.className = 'calendar-day';
    
    if (isOtherMonth) {
        dayElement.classList.add('other-month');
    } else {
        dayElement.innerHTML = `<div class="day-number">${day}</div>`;
        
        // Check if this day has interviews
        const dateStr = formatDate(currentDate.getFullYear(), currentDate.getMonth(), day);
        const dayInterviews = interviews.filter(interview => interview.date === dateStr);
        
        if (dayInterviews.length > 0) {
            dayElement.classList.add('has-interview');
            dayInterviews.forEach(interview => {
                const eventElement = document.createElement('div');
                eventElement.className = `interview-event ${interview.type}`;
                eventElement.textContent = interview.title;
                eventElement.title = `${interview.title} at ${interview.time}`;
                dayElement.appendChild(eventElement);
            });
        }
        
        // Check if this is today
        const today = new Date();
        if (currentDate.getFullYear() === today.getFullYear() &&
            currentDate.getMonth() === today.getMonth() &&
            day === today.getDate()) {
            dayElement.classList.add('today');
        }
        
        // Add click handler
        dayElement.addEventListener('click', () => {
            showDayDetails(dateStr, dayInterviews);
        });
    }
    
    return dayElement;
}

function formatDate(year, month, day) {
    return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
}

function previousMonth() {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
}

function nextMonth() {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
}

function goToToday() {
    currentDate = new Date();
    renderCalendar();
}

function showAddInterviewModal() {
    // Set default date to today
    const today = new Date();
    document.getElementById('interviewDate').value = today.toISOString().split('T')[0];
    
    const modal = new bootstrap.Modal(document.getElementById('addInterviewModal'));
    modal.show();
}

function saveInterview() {
    const title = document.getElementById('interviewTitle').value;
    const type = document.getElementById('interviewType').value;
    const date = document.getElementById('interviewDate').value;
    const time = document.getElementById('interviewTime').value;
    const duration = document.getElementById('interviewDuration').value;
    const notes = document.getElementById('interviewNotes').value;
    
    if (!title || !date || !time) {
        alert('Please fill in all required fields');
        return;
    }
    
    const newInterview = {
        id: Date.now(),
        title,
        type,
        date,
        time,
        duration: parseInt(duration),
        notes
    };
    
    interviews.push(newInterview);
    saveInterviews();
    renderCalendar();
    updateStats();
    
    // Close modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('addInterviewModal'));
    modal.hide();
    
    // Reset form
    document.getElementById('addInterviewForm').reset();
    
    showMessage('Interview added successfully!', 'success');
}

function showDayDetails(date, dayInterviews) {
    if (dayInterviews.length === 0) {
        showMessage('No interviews scheduled for this day', 'info');
        return;
    }
    
    let message = `Interviews for ${new Date(date).toLocaleDateString()}:\n\n`;
    dayInterviews.forEach(interview => {
        message += `• ${interview.title} at ${interview.time} (${interview.duration} min)\n`;
        if (interview.notes) {
            message += `  Notes: ${interview.notes}\n`;
        }
        message += '\n';
    });
    
    alert(message);
}

function updateStats() {
    const total = interviews.length;
    const thisMonth = interviews.filter(interview => {
        const interviewDate = new Date(interview.date);
        return interviewDate.getMonth() === currentDate.getMonth() &&
               interviewDate.getFullYear() === currentDate.getFullYear();
    }).length;
    
    const today = new Date().toISOString().split('T')[0];
    const completed = interviews.filter(interview => interview.date < today).length;
    const upcoming = interviews.filter(interview => interview.date >= today).length;
    
    document.getElementById('total-interviews').textContent = total;
    document.getElementById('this-month').textContent = thisMonth;
    document.getElementById('completed').textContent = completed;
    document.getElementById('upcoming').textContent = upcoming;
}

function exportCalendar() {
    const dataStr = JSON.stringify(interviews, null, 2);
    const dataBlob = new Blob([dataStr], {type: 'application/json'});
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'interview-calendar.json';
    link.click();
    URL.revokeObjectURL(url);
}

function showMessage(message, type = 'info') {
    const alertClass = type === 'error' ? 'alert-danger' : 
                      type === 'warning' ? 'alert-warning' : 
                      type === 'success' ? 'alert-success' : 'alert-info';
    
    const alertHtml = `
        <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    `;
    
    const container = document.querySelector('.container');
    container.insertAdjacentHTML('afterbegin', alertHtml);
    
    setTimeout(() => {
        const alert = container.querySelector('.alert');
        if (alert) {
            alert.remove();
        }
    }, 5000);
}
</script>
{% endblock %}

