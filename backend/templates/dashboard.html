{% extends "base.html" %}

{% block title %}Dashboard - Web-Inter-Prep{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Welcome Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h1 class="card-title h3 mb-2">
                        <i class="fas fa-wave-square me-2"></i>Welcome back, {{ session.user_name if session.user_id else 'Guest' }}!
                    </h1>
                    <p class="card-text mb-0">Ready to continue your interview preparation journey?</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard Content -->
    <div class="row">
        <!-- Left Column - Profile Card -->
        <div class="col-lg-3 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <div class="profile-icon mb-3">
                        <i class="fas fa-user-circle text-success display-4"></i>
                    </div>
                    <h5 class="card-title">{{ session.user_name if session.user_id else 'Your Name' }}</h5>
                    <p class="text-muted mb-3">{{ session.user_email if session.user_id else 'your.email@example.com' }}</p>
                    {% if not session.user_id %}
                    <a href="{{ url_for('login') }}" class="btn btn-primary">
                        <i class="fas fa-arrow-right me-2"></i>Login/Register Required
                    </a>
                    {% else %}
                    <div class="text-success">
                        <i class="fas fa-check-circle me-2"></i>Logged In
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Center Column - Interview Statistics -->
        <div class="col-lg-9 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-line text-primary me-2"></i>Interview Statistics
                        </h5>
                        <small class="text-muted">Last 30 Days</small>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Statistics Cards Row -->
                    <div class="row mb-4">
                        <div class="col-md-3 mb-3">
                            <div class="stat-card text-center p-3 rounded">
                                <i class="fas fa-briefcase text-primary display-6 mb-2"></i>
                                <h3 class="text-primary mb-0">{{ stats.total_interviews if session.user_id and stats else '0' }}</h3>
                                <small class="text-muted">Mock Interviews</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="stat-card text-center p-3 rounded">
                                <i class="fas fa-clock text-info display-6 mb-2"></i>
                                <h3 class="text-info mb-0">{{ (stats.total_study_time // 60) if session.user_id and stats else '0' }}</h3>
                                <small class="text-muted">Study Hours</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="stat-card text-center p-3 rounded">
                                <i class="fas fa-check-circle text-success display-6 mb-2"></i>
                                <h3 class="text-success mb-0">{{ stats.correct_answers if session.user_id and stats else '0' }}</h3>
                                <small class="text-muted">Correct Answers</small>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="stat-card text-center p-3 rounded">
                                <i class="fas fa-fire text-danger display-6 mb-2"></i>
                                <h3 class="text-danger mb-0">{{ stats.current_streak if session.user_id and stats else '0' }}</h3>
                                <small class="text-muted">Day Streak</small>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Bar -->
                    <div class="performance-section">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <h6 class="mb-0">
                                <i class="fas fa-star text-warning me-2"></i>Average Performance
                            </h6>
                            <span class="text-primary fw-bold">{{ stats.score_out_of_10 if session.user_id and stats else '0' }} / 10</span>
                        </div>
                        <div class="progress" style="height: 12px;">
                            <div class="progress-bar bg-primary" role="progressbar" 
                                 style="width: {{ (stats.score_out_of_10 / 10 * 100) if session.user_id and stats else 0 }}%"
                                 aria-valuenow="{{ stats.score_out_of_10 if session.user_id and stats else 0 }}" 
                                 aria-valuemin="0" aria-valuemax="10">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Additional Statistics Row -->
                    <div class="row mt-4">
                        <!-- Weak Topics -->
                        <div class="col-md-6">
                            <div class="weak-topics-section">
                                <h6 class="mb-3">
                                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>Areas for Improvement
                                </h6>
                                {% if session.user_id and stats.weak_topics %}
                                    {% for topic in stats.weak_topics %}
                                    <div class="weak-topic-item d-flex justify-content-between align-items-center mb-2 p-2 rounded">
                                        <span class="fw-medium">{{ topic.name }}</span>
                                        <span class="badge bg-warning text-dark">{{ topic.count }} mistakes</span>
                                    </div>
                                    {% endfor %}
                                {% else %}
                                    <div class="text-muted text-center py-3">
                                        <i class="fas fa-check-circle text-success display-6 mb-2"></i>
                                        <p class="mb-0">Great job! No weak areas detected yet.</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- Recent Performance -->
                        <div class="col-md-6">
                            <div class="recent-performance-section">
                                <h6 class="mb-3">
                                    <i class="fas fa-chart-bar text-info me-2"></i>Recent Performance
                                </h6>
                                {% if session.user_id and stats.total_attempted > 0 %}
                                    <div class="performance-metrics">
                                        <div class="metric-item d-flex justify-content-between align-items-center mb-2">
                                            <span>Total Questions:</span>
                                            <span class="fw-bold text-primary">{{ stats.total_attempted }}</span>
                                        </div>
                                        <div class="metric-item d-flex justify-content-between align-items-center mb-2">
                                            <span>Accuracy Rate:</span>
                                            <span class="fw-bold text-success">{{ stats.accuracy }}%</span>
                                        </div>
                                        <div class="metric-item d-flex justify-content-between align-items-center mb-2">
                                            <span>Study Time:</span>
                                            <span class="fw-bold text-info">{{ (stats.total_study_time // 60) }}h {{ stats.total_study_time % 60 }}m</span>
                                        </div>
                                    </div>
                                {% else %}
                                    <div class="text-muted text-center py-3">
                                        <i class="fas fa-chart-line text-muted display-6 mb-2"></i>
                                        <p class="mb-0">Start practicing to see your performance metrics!</p>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Section - Recent Interviews -->
    <div class="row">
        <div class="col-12">
            <div class="card bg-primary text-white shadow-sm">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-history me-2"></i>Recent Interviews
                        </h5>
                        <a href="{{ url_for('mock_interview') if session.user_id else url_for('login') }}" class="btn btn-light">
                            <i class="fas fa-plus me-2"></i>Add/View Interviews
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Recent Interviews Content -->
            <div class="card border-top-0 rounded-top-0 shadow-sm">
                <div class="card-body">
                    {% if session.user_id and stats.recent_interviews %}
                        <!-- Show actual interview history -->
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Date</th>
                                        <th>Questions</th>
                                        <th>Correct</th>
                                        <th>Score</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for interview in stats.recent_interviews %}
                                    <tr>
                                        <td>
                                            <small class="text-muted">
                                                {{ interview[2][:10] if interview[2] else 'N/A' }}
                                            </small>
                                        </td>
                                        <td>{{ interview[0] }}</td>
                                        <td>{{ interview[1] }}</td>
                                        <td>
                                            <span class="badge bg-{{ 'success' if (interview[0] > 0 and (interview[1]/interview[0]*100) >= 70) else 'warning' if (interview[0] > 0 and (interview[1]/interview[0]*100) >= 50) else 'danger' }}">
                                                {{ "%.1f"|format(interview[1]/interview[0]*100) if interview[0] > 0 else 0 }}%
                                            </span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% elif session.user_id and stats.total_attempted > 0 %}
                        <!-- Show practice history instead -->
                        <div class="text-center py-4">
                            <i class="fas fa-list-ul display-4 mb-3 text-muted"></i>
                            <h5>Practice History Available</h5>
                            <p>You have {{ stats.total_attempted }} practice attempts. Start a mock interview to see detailed results!</p>
                            <a href="{{ url_for('mock_interview') }}" class="btn btn-primary">
                                <i class="fas fa-play me-2"></i>Start Mock Interview
                            </a>
                        </div>
                    {% else %}
                        <!-- Empty state -->
                        <div class="text-center py-5">
                            <i class="fas fa-calendar-plus display-1 mb-3 text-muted"></i>
                            <h5>No interviews yet</h5>
                            <p>Start your first interview to see your progress here!</p>
                            <a href="{{ url_for('mock_interview') if session.user_id else url_for('login') }}" class="btn btn-primary">
                                <i class="fas fa-play me-2"></i>Start Interview
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Achievements and Goals Section -->
    {% if session.user_id %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-trophy me-2"></i>Achievements & Goals
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <!-- Current Streak -->
                        <div class="col-md-4 text-center mb-3">
                            <div class="achievement-item">
                                <div class="achievement-icon mb-2">
                                    <i class="fas fa-fire text-danger display-4"></i>
                                </div>
                                <h4 class="text-danger mb-1">{{ stats.current_streak }}</h4>
                                <p class="text-muted mb-0">Day Streak</p>
                                <small class="text-success">
                                    {% if stats.current_streak >= 7 %}
                                        🔥 7-day streak achieved!
                                    {% elif stats.current_streak >= 3 %}
                                        🚀 Keep it up!
                                    {% else %}
                                        💪 Start building your streak
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        
                        <!-- Accuracy Goal -->
                        <div class="col-md-4 text-center mb-3">
                            <div class="achievement-item">
                                <div class="achievement-icon mb-2">
                                    <i class="fas fa-bullseye text-primary display-4"></i>
                                </div>
                                <h4 class="text-primary mb-1">{{ stats.accuracy }}%</h4>
                                <p class="text-muted mb-0">Accuracy Rate</p>
                                <small class="text-success">
                                    {% if stats.accuracy >= 90 %}
                                        🎯 Excellent accuracy!
                                    {% elif stats.accuracy >= 75 %}
                                        🎯 Good progress!
                                    {% else %}
                                        📚 Keep practicing
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        
                        <!-- Study Time -->
                        <div class="col-md-4 text-center mb-3">
                            <div class="achievement-item">
                                <div class="achievement-icon mb-2">
                                    <i class="fas fa-clock text-info display-4"></i>
                                </div>
                                <h4 class="text-info mb-1">{{ (stats.total_study_time // 60) }}h</h4>
                                <p class="text-muted mb-0">Total Study Time</p>
                                <small class="text-success">
                                    {% if stats.total_study_time >= 300 %}
                                        ⏰ 5+ hours of practice!
                                    {% elif stats.total_study_time >= 120 %}
                                        ⏰ 2+ hours of practice!
                                    {% else %}
                                        ⏰ Every minute counts!
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Quick Actions Row -->
    {% if session.user_id %}
    <div class="row mt-4">
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-play-circle text-primary display-3 mb-3"></i>
                    <h4 class="card-title">Quick Practice</h4>
                    <p class="card-text">Practice individual questions at your own pace. Perfect for daily practice sessions.</p>
                    <a href="{{ url_for('practice') }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-play me-2"></i>Start Practice
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-clock text-warning display-3 mb-3"></i>
                    <h4 class="card-title">Mock Interview</h4>
                    <p class="card-text">Take a timed 30-minute mock interview to simulate real interview conditions.</p>
                    <a href="{{ url_for('mock_interview') }}" class="btn btn-warning btn-lg">
                        <i class="fas fa-stopwatch me-2"></i>Start Mock
                    </a>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4 mb-4">
            <div class="card h-100 shadow-sm">
                <div class="card-body text-center">
                    <i class="fas fa-route text-success display-3 mb-3"></i>
                    <h4 class="card-title">Career Roadmap</h4>
                    <p class="card-text">Generate a personalized career roadmap based on your goals and experience.</p>
                    <a href="{{ url_for('career_roadmap') }}" class="btn btn-success btn-lg">
                        <i class="fas fa-magic me-2"></i>Generate Roadmap
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_css %}
<style>
.stat-card {
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease-in-out;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    background-color: white;
}

.profile-icon {
    transition: all 0.3s ease-in-out;
}

.profile-icon:hover {
    transform: scale(1.1);
}

.performance-section {
    background-color: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e9ecef;
}

.progress {
    border-radius: 6px;
    background-color: #e9ecef;
}

.progress-bar {
    border-radius: 6px;
    transition: width 1s ease-in-out;
}

.card {
    border-radius: 12px;
    overflow: hidden;
}

.card-header {
    padding: 1.25rem 1.5rem;
}

.display-6 {
    font-size: 2.5rem;
}

.weak-topics-section, .recent-performance-section {
    background-color: #f8f9fa;
    padding: 1.5rem;
    border-radius: 8px;
    border: 1px solid #e9ecef;
    height: 100%;
}

.weak-topic-item {
    background-color: white;
    border: 1px solid #e9ecef;
    transition: all 0.3s ease-in-out;
}

.weak-topic-item:hover {
    background-color: #f8f9fa;
    transform: translateX(5px);
}

.performance-metrics .metric-item {
    padding: 0.5rem 0;
    border-bottom: 1px solid #e9ecef;
}

.performance-metrics .metric-item:last-child {
    border-bottom: none;
}

.table {
    margin-bottom: 0;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
}

.table td {
    vertical-align: middle;
}

.badge {
    font-size: 0.8rem;
    padding: 0.4rem 0.6rem;
}

.achievement-item {
    padding: 1rem;
    border-radius: 8px;
    transition: all 0.3s ease-in-out;
}

.achievement-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.achievement-icon {
    transition: all 0.3s ease-in-out;
}

.achievement-icon:hover {
    transform: scale(1.1);
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
}

.card-header.bg-gradient-primary {
    border: none;
}
</style>
{% endblock %}
